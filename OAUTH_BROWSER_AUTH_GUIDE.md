# OAuth認証の画面遷移（詳細）

## 画面1: Googleアカウント選択

表示される画面:
```
Google にログイン
YouTube Clipper OAuth にログインするには、Google アカウントを選択してください。
```

**やること:**
- YouTube Data API KEYを設定したアカウントを選択
- または「別のアカウントを使用」をクリックしてログイン

---

## 画面2: アプリ確認警告（重要）

表示される画面:
```
このアプリは確認されていません

このアプリは Google による確認を受けていません。
よく知っている信頼できるデベロッパーでない場合は続行しないでください。
```

**これは正常です！** あなた自身が作成したアプリなので安全です。

**やること:**
1. 「詳細」リンクをクリック
2. 「（安全ではないページ）に移動」または「YouTube Clipper OAuth（安全ではないページ）に移動」をクリック

**画面イメージ:**
```
┌────────────────────────────────────────┐
│ ⚠️ このアプリは確認されていません       │
│                                        │
│ このアプリは Google による確認を       │
│ 受けていません。                       │
│                                        │
│ 詳細 ▼                                 │ ← ここをクリック
└────────────────────────────────────────┘

↓ クリック後

┌────────────────────────────────────────┐
│ ⚠️ このアプリは確認されていません       │
│                                        │
│ このアプリは確認されていませんが、      │
│ 続行することができます。               │
│                                        │
│ YouTube Clipper OAuth（安全では        │
│ ないページ）に移動                     │ ← ここをクリック
└────────────────────────────────────────┘
```

---

## 画面3: 権限リクエスト確認

表示される画面:
```
YouTube Clipper OAuth が Google アカウントへのアクセスをリクエストしています

このアプリは次の権限を要求しています:

✓ YouTube アカウントの表示
✓ YouTube データの表示と管理
✓ YouTube Analytics レポートの表示

続行すると、YouTube Clipper OAuth が上記の操作を実行できるようになります。
```

**確認するポイント:**
- YouTube アカウントの表示 ← ✅
- YouTube データの表示と管理 ← ✅
- YouTube Analytics レポートの表示 ← ✅ これが重要！

**やること:**
- 下にスクロールして「許可」ボタンをクリック

**画面イメージ:**
```
┌────────────────────────────────────────┐
│ YouTube Clipper OAuth が Google        │
│ アカウントへのアクセスをリクエスト     │
│ しています                             │
│                                        │
│ ✓ YouTube アカウントの表示             │
│ ✓ YouTube データの表示と管理           │
│ ✓ YouTube Analytics レポートの表示     │
│                                        │
│ [キャンセル]  [許可] ← クリック        │
└────────────────────────────────────────┘
```

---

## 画面4: 認証完了

表示される画面:
```
認証フローが完了しました。
このウィンドウを閉じてもかまいません。
```

または

```
The authentication flow has completed. You may close this window.
```

**やること:**
- ブラウザのタブを閉じる
- ターミナル/コマンドプロンプトに戻る

---

## ターミナルの出力（成功時）

認証が成功すると、ターミナルに以下のように表示されます:

```
✓ OAuth トークンを環境変数から復元しました
✓ YouTube Analytics API v2 が初期化されました

============================================================
✅ OAuth認証が完了しました！
============================================================

token.pickle ファイルが生成されました。

次のステップ:
1. token.pickle をBase64エンコード:
   base64 token.pickle

2. 出力された文字列をコピー

3. Renderの環境変数に設定:
   YOUTUBE_OAUTH_TOKEN=<コピーした文字列>

============================================================
テスト: チャンネル情報を取得
============================================================

✓ チャンネル名: XXXXX
✓ 登録者数: XXXXX

最近の配信: XXXXX
動画ID: XXXXX

視聴維持率データを取得中...
✅ 視聴維持率データを取得: XX ポイント
   動画の長さ: XXXX秒
```

**この時点で `token.pickle` ファイルが生成されています！**

---

## よくある問題と解決策

### 問題1: ブラウザが開かない

**原因:** ファイアウォールまたはブラウザ設定

**解決策:**
```bash
# 手動でURLを開く
# ターミナルに表示されるURLをコピーしてブラウザに貼り付け
```

---

### 問題2: 「アクセスが拒否されました」エラー

**原因:** YouTube Studioで権限が付与されていない

**解決策:**
1. チャンネル運営アカウントでYouTube Studioにログイン
2. 設定 → 権限 → 権限を管理
3. API設定アカウントに「管理者（完全）」権限を付与

---

### 問題3: 「credentials.json が見つかりません」

**原因:** ファイルが正しい場所に配置されていない

**解決策:**
```bash
# 現在のディレクトリを確認
pwd  # Mac/Linux
cd   # Windows

# credentials.jsonがあるか確認
ls -la credentials.json  # Mac/Linux
dir credentials.json     # Windows

# なければ正しい場所に配置
```

---

### 問題4: 「YOUTUBE_API_KEY が設定されていません」

**原因:** .envファイルが正しく作成されていない

**解決策:**
```bash
# .envファイルを作成
cp .env.example .env

# .envファイルを編集してAPIキーを記載
nano .env  # Mac/Linux
notepad .env  # Windows

# 内容:
YOUTUBE_API_KEY=あなたのAPIキー
TARGET_CHANNEL_IDS=UCrzO_hsFW8vLLy8xFBADfqQ,UC3NYX0zN6GySr_hzJHU4tog
```

---

## 次のステップ

認証が成功したら、次のステップに進みます:
- token.pickleをBase64エンコード
- Renderに環境変数を設定
