# 🧪 テストモード使用ガイド

## 概要

1本の動画だけを処理して、システムが正常に動作するかテストできます。

## 🖥️ Webダッシュボードでのテスト

### URL
```
https://create-cut-out-videos.onrender.com
```

### 🧪 テストモードセクション

ダッシュボードに新しく追加された「🧪 テストモード」セクションで以下ができます：

#### 方法1: 動画IDを直接入力

1. **動画IDを取得**
   - YouTubeで動画を開く
   - URLから動画IDをコピー
   - 例: `https://www.youtube.com/watch?v=dQw4w9WgXcQ` → `dQw4w9WgXcQ`

2. **入力欄に貼り付け**
   ```
   [動画IDを入力: dQw4w9WgXcQ        ]
   ```

3. **「🎬 この動画を処理」ボタンをクリック**

4. **確認ダイアログで「OK」**
   ```
   動画ID: dQw4w9WgXcQ
   この動画を処理しますか？テストのため時間がかかります。
   ```

5. **処理完了まで待つ（20-40分）**

6. **結果を確認**
   - 成功: `✅ テスト処理成功! 出力: ./output/xxxxx_highlight.mp4`
   - 失敗: `❌ テスト処理失敗 エラー: ...`

#### 方法2: 最近の配信から選択

1. **「📋 最近の配信から選択」ボタンをクリック**

2. **配信リストが表示される**
   ```
   最近の配信 (5本):
   
   1. 【配信タイトル1】
      ID: xxxxx
      公開: 2026-01-18
      [この動画を選択]
   
   2. 【配信タイトル2】
      ID: yyyyy
      公開: 2026-01-17
      [この動画を選択]
   ...
   ```

3. **好きな配信の「この動画を選択」ボタンをクリック**

4. **動画IDが自動入力される**

5. **「🎬 この動画を処理」ボタンをクリック**

## 💻 コマンドラインでのテスト

### 対話形式（推奨）

```bash
python test_run.py
```

実行すると以下の選択肢が表示されます：

```
============================================================
YouTube切り抜き動画生成システム - テストモード
============================================================

対象チャンネル数: 2

テスト方法を選択してください:
1. 動画IDを直接入力
2. 最新の配信から1本選択

選択 (1 または 2):
```

#### 選択肢1: 動画IDを直接入力

```bash
選択 (1 または 2): 1

動画ID（例: dQw4w9WgXcQ）を入力: xxxxx

動画ID: xxxxx を処理します...

============================================================
処理を開始しますか？
============================================================
続行 (y/n): y

============================================================
処理開始
============================================================
...
```

#### 選択肢2: 最新の配信から選択

```bash
選択 (1 または 2): 2

チャンネルの最新配信を取得中...

チャンネル: UCrzO_hsFW8vLLy8xFBADfqQ

最近の配信 (5本):
------------------------------------------------------------
1. 【配信タイトル1】
   ID: xxxxx | 公開: 2026-01-18

2. 【配信タイトル2】
   ID: yyyyy | 公開: 2026-01-17
...

処理する動画を選択 (1-5): 1

選択: 【配信タイトル1】

============================================================
処理を開始しますか？
============================================================
続行 (y/n): y
```

### 動画IDを引数で指定

```bash
python test_run.py video dQw4w9WgXcQ
```

すぐに処理が開始されます（確認なし）。

### API接続テスト

```bash
python test_run.py api
```

YouTube APIに正常に接続できるかテストします。

**出力例**:
```
============================================================
YouTube API接続テスト
============================================================

チャンネル: UCrzO_hsFW8vLLy8xFBADfqQ
  ✅ チャンネル名: テストチャンネル
  ✅ 登録者数: 10000
  ✅ 最新配信: 【配信タイトル】

チャンネル: UC3NYX0zN6GySr_hzJHU4tog
  ✅ チャンネル名: テストチャンネル2
  ✅ 登録者数: 5000
  ✅ 最新配信: 【配信タイトル】
```

## 📊 処理結果の確認

### 成功した場合

```
============================================================
処理結果
============================================================
✅ 処理成功！

動画タイトル: 【配信タイトル】
出力ファイル: ./output/xxxxx_配信タイトル_highlight.mp4
動画の長さ: 01:35:42
見どころ数: 5個

見どころタイムスタンプ:
  1. 12:34 - 14:56 (スコア: 0.85)
  2. 25:00 - 27:30 (スコア: 0.82)
  3. 40:15 - 42:45 (スコア: 0.78)
  4. 55:20 - 57:50 (スコア: 0.75)
  5. 01:10:30 - 01:13:00 (スコア: 0.72)

============================================================
```

### 失敗した場合

```
============================================================
処理結果
============================================================
❌ 処理失敗
エラー: 動画情報取得失敗

============================================================
```

## 🔍 よくあるエラーと対処法

### エラー1: `動画情報取得失敗`

**原因**:
- 動画IDが間違っている
- 動画が非公開または削除されている
- 動画が配信（ライブストリーム）ではない

**対処法**:
- 動画IDを確認する
- 公開されている配信動画を選択する

### エラー2: `YouTube API認証エラー`

**原因**:
- API Keyが設定されていない
- API Keyが無効

**対処法**:
```bash
# .envファイルを確認
cat .env

# YOUTUBE_API_KEYが設定されているか確認
# 設定されていなければ追加
echo "YOUTUBE_API_KEY=あなたのAPIキー" >> .env
```

### エラー3: `コメント取得失敗`

**原因**:
- コメントが無効になっている
- APIクォータ超過

**対処法**:
- これは致命的なエラーではない
- コメントなしで処理が続行される

### エラー4: `動画ダウンロード失敗`

**原因**:
- ネットワークエラー
- 動画が長すぎる
- yt-dlpのバージョンが古い

**対処法**:
```bash
# yt-dlpを最新版に更新
pip install --upgrade yt-dlp
```

### エラー5: `無音削除エラー`

**原因**:
- FFmpegのメモリ不足
- 動画が破損している

**対処法**:
- ジャンプカットを無効にする
```bash
# .envで設定
JUMP_CUT_ENABLED=false
```

## ⏱️ 処理時間の目安

| 元動画の長さ | 処理時間 |
|------------|---------|
| 30分 | 15-20分 |
| 1時間 | 20-30分 |
| 2時間 | 30-50分 |
| 3時間 | 50-80分 |

**処理内容**:
1. 動画ダウンロード (5-10分)
2. コメント・統計分析 (1-2分)
3. セグメント抽出 (3-5分)
4. ジャンプカット (5-10分)
5. 音声認識 (5-15分)
6. 字幕焼き込み (5-10分)

## 📁 出力ファイル

### 保存場所
```
./output/
```

### ファイル名形式
```
{動画ID}_{動画タイトル}_highlight.mp4
```

**例**:
```
dQw4w9WgXcQ_配信タイトル_highlight.mp4
```

### ファイルサイズ
- 10分の切り抜き動画: 約200-500MB
- 1080p、字幕焼き込み済み

## 🎯 テストのベストプラクティス

### 1. 短い動画でテスト
- 最初は30分以下の配信でテスト
- システムが正常に動作するか確認

### 2. API接続を先にテスト
```bash
python test_run.py api
```
- YouTube APIに接続できるか確認
- チャンネル情報が取得できるか確認

### 3. 見どころが多い配信を選ぶ
- コメントが多い配信
- 視聴回数が多い配信
- エンゲージメントが高い配信

### 4. ログを確認
```bash
# 処理ログ
tail -f ./logs/clipper.log

# テストログ
tail -f ./logs/test.log
```

### 5. 失敗したら原因を確認
- エラーメッセージを確認
- ログファイルを確認
- 環境変数を確認

## 🔄 再テストの方法

### 同じ動画で再テスト

出力ファイルを削除してから再実行：

```bash
# 出力ファイルを削除
rm ./output/*

# 再テスト
python test_run.py
```

### 一時ファイルもクリア

```bash
# 一時ファイルとダウンロードファイルを削除
rm -rf ./temp/* ./downloads/*

# 再テスト
python test_run.py
```

## 📝 次のステップ

テストが成功したら：

1. ✅ 自動実行を有効にする
2. ✅ Cron Jobを設定する
3. ✅ 毎日の自動処理を開始

---

**GitHubリポジトリ**: https://github.com/kyo10310415/Create-cut-out-videos  
**デプロイURL**: https://create-cut-out-videos.onrender.com  
**最終更新**: 2026-01-18
